<!doctype html>
<html lang="zh-Hant-TW">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>å¸æ©Ÿé é¢</title>
<style>
:root{
  --teal:#2B7CFF; --text:#051D4B; --muted:#6b7b80; --line:#e7f0f1; --field:#B7C1CC; --bg:#f6f8fb;
  --radius:18px; --radius-ipt:16px;
}
html,body{height:100%;margin:0;background:var(--bg);font-family:system-ui,"Noto Sans TC",Arial;color:var(--text);-webkit-text-size-adjust:none}
#driver-app{width:390px;max-width:390px;margin:0 auto;padding:0 16px 40px}

/* æ¨™é¡Œ */
.h1{font-size:26px;font-weight:900;margin:50px 0 6px;text-align:center}
.h2{font-size:15px;color:var(--muted);text-align:center;margin:0 0 16px}

/* å¡ç‰‡ */
.card{background:#fff;border:1px solid var(--line);border-radius:var(--radius);padding:16px 16px 14px;margin-bottom:16px;box-shadow:0 6px 20px rgba(0,0,0,.04)}
.lbl{font-weight:800}
.muted{color:var(--muted);font-size:12px}
.grid{display:grid;gap:10px}

/* Inputs */
#driver-app .ipt, #driver-app select.ipt, #driver-app textarea.ipt{
  width:100%;padding:12px 14px;font-size:15px;background:#fff!important;border:1px solid var(--field)!important;border-radius:var(--radius-ipt)!important;
  -webkit-appearance:none;appearance:none;box-shadow:none!important;background-clip:padding-box;
}
#driver-app input:focus, #driver-app select:focus, #driver-app textarea:focus{
  border-color:var(--teal)!important;box-shadow:0 0 0 2px rgba(43,124,255,.12)!important;outline:none!important;
}

/* Modal inputs ä¹Ÿåƒæ¨£å¼ */
.modal .ipt{border:1px solid var(--field)!important;border-radius:var(--radius-ipt)!important;padding:12px 14px;font-size:15px}
.modal .ipt:focus{border-color:var(--teal)!important;box-shadow:0 0 0 2px rgba(43,124,255,.15)!important;outline:none!important}

/* Buttons */
#driver-app .btn, #driver-app button.btn, #driver-app a.btn, #driver-app .card .btn{
  display:inline-flex;align-items:center;justify-content:center;
  padding:12px 18px;border-radius:50px!important;background:var(--teal)!important;border:1px solid var(--teal)!important;
  color:#fff!important;font-weight:900!important;letter-spacing:.02em;line-height:1!important;
  text-decoration:none!important;cursor:pointer;transition:.2s;font-size:16px!important;
}
#driver-app .btn[disabled]{opacity:.5;cursor:not-allowed}
.w100{width:100%}
.actions{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}
.actions.vertical{flex-direction:column}

/* è¨‚å–®å¡ç‰‡å¼è¡¨ */
.tbl{width:100%;border-collapse:separate;border-spacing:0 8px;table-layout:fixed}
.tbl th,.tbl td{padding:10px 8px;border:1px solid var(--line);background:#fff}
.tbl thead{display:none}
.tbl.responsive tbody>tr{display:grid;grid-template-columns:1fr auto;gap:6px;border:1px solid var(--line);border-radius:12px;padding:10px;background:#fff}
.tbl.responsive tbody>tr td{border:none;padding:0;background:transparent;white-space:normal;word-break:break-word;overflow-wrap:anywhere}
.tbl.responsive td[data-col="id"]{grid-column:1/2;font-weight:900;font-size:16px;letter-spacing:.3px}
.tbl.responsive td[data-col="amount"]{grid-column:2/3;justify-self:end;font-weight:900}
.tbl.responsive td[data-col="type"],.tbl.responsive td[data-col="date"]{grid-column:1/2;color:#2b3b55}
.tbl.responsive td[data-col="status"]{grid-column:2/3;justify-self:end}
.order-row{cursor:pointer}
.badge{display:inline-block;padding:2px 8px;border-radius:999px;border:1px solid var(--line);font-size:12px}
.badge.ing{background:#f4f8ff} .badge.done{background:#f3fbf5} .badge.cancel{background:#fff6f6}

/* Modal */
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.28);z-index:9999;padding:12px}
.modal.active{display:flex}
.modal-box{width:100%;max-width:390px;max-height:85vh;overflow:auto;background:#fff;border:1px solid var(--line);border-radius:var(--radius);padding:16px;box-shadow:0 8px 24px rgba(0,0,0,.12)}
.modal-head{display:flex;justify-content:space-between;align-items:center;margin:0 0 10px}
.modal-title{font-size:18px;font-weight:900;color:var(--text);margin:0}
.modal-close{cursor:pointer;font-size:20px;color:var(--muted);font-weight:700;background:transparent;border:0}

/* ä¸Šå‚³æ¨£å¼ï¼ˆåŒè¨»å†Šï¼‰ */
.upload-col{display:grid;gap:10px}
.file{position:relative}
.file input[type=file]{position:absolute;inset:0;opacity:0;cursor:pointer}
.fake{border:1px solid var(--teal);border-radius:var(--radius-ipt);padding:12px 0;text-align:center;font-weight:800;color:var(--teal)}
.file-name{font-size:13px;color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

/* è¿”å›éµ */
.back{position:fixed;left:10px;top:10px;z-index:10;width:38px;height:38px;border-radius:50%;background:#fff;border:1px solid var(--line);display:flex;align-items:center;justify-content:center;box-shadow:0 4px 10px rgba(0,0,0,.08)}
.back svg{width:20px;height:20px;stroke:var(--teal)}

/* KV */
.sep{height:1px;background:var(--line);margin:12px 0}
.kv{display:grid;grid-template-columns:110px 1fr;gap:8px}
.kv .key{font-weight:800}
.kv .val{overflow-wrap:anywhere}

/* é€£çµ */
.logout-link{display:block;margin:12px auto 0;color:var(--teal);text-decoration:underline;cursor:pointer}
/* ğŸš« å¯©æ ¸æœªé€šéæç¤ºæ¡† */
.alert-card{
  border:1px solid #FFB5B5!important;
  background:#FFF5F5!important;
  box-shadow:0 4px 12px rgba(255,0,0,.05)!important;
  text-align:center;
  padding:20px 16px!important;
}
</style>
</head>
<body>

<button class="back" id="btnBack" aria-label="è¿”å›ä¸Šä¸€é ">
  <svg viewBox="0 0 24 24" fill="none" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
</button>

<div id="driver-app">
  <div class="h1">å¸æ©Ÿå¸³æˆ¶</div>
<div class="h2" id="welcome">æ­¡è¿å›ä¾†</div>
<!-- ğŸ”´ æ–‡ä»¶æœ‰èª¤æç¤ºæ¬„ï¼ˆæœ€çµ‚ç‰ˆï¼‰ -->
<div id="alertBox" style="
  background:#FFF5F5;
  border:1px solid #FFB5B5;
  color:#B30000;
  border-radius:16px;
  padding:20px 16px;
  text-align:center;
  margin:0 auto 20px;
  max-width:360px;
  box-shadow:0 4px 10px rgba(0,0,0,.03);
">
  <div style="font-weight:900;font-size:16px;margin-bottom:14px;">
    æ–‡ä»¶æœ‰èª¤ï¼Œè«‹é‡æ–°ä¸Šå‚³
  </div>
  <div style="display:flex;justify-content:center;">
    <button id="btnReupload" style="
      background:#B30000;
      color:#fff;
      font-size:15px;
      font-weight:800;
      border:none;
      border-radius:50px;
      padding:10px 28px;
      cursor:pointer;
      transition:all .25s ease;
      display:inline-block;
    "
    onmouseover="this.style.background='#8E0000'"
    onmouseout="this.style.background='#B30000'">
      ä¸Šå‚³è³‡æ–™
    </button>
  </div>
</div>

  <!-- æ‘˜è¦ -->
  <div class="card" id="profileView">
    <div class="grid">
      <div class="kv"><div class="key">å¸³æˆ¶</div><div class="val" id="v_acc">â€”</div></div>
      <div class="kv"><div class="key">å§“å</div><div class="val" id="v_name">â€”</div></div>
      <div class="kv"><div class="key">é›»è©±</div><div class="val" id="v_phone">â€”</div></div>
      <div class="kv"><div class="key">Email</div><div class="val" id="v_mail">â€”</div></div>
      <div class="kv"><div class="key">åœ°å€</div><div class="val" id="v_addr">â€”</div></div>
      <div class="kv"><div class="key">é§•ç…§åˆ°æœŸ</div><div class="val" id="v_licenseDue">â€”</div></div>
      <div class="kv"><div class="key">ä¿éšªåˆ°æœŸ</div><div class="val" id="v_insDue">â€”</div></div>
    </div>
    <div class="actions" style="justify-content:center">
      <button id="btnEdit" class="btn" type="button">ç·¨è¼¯</button>
    </div>
  </div>
<!-- ğŸš« å¯©æ ¸æœªé€šéæç¤ºæ¡† -->
<div class="card alert-card" id="alertPermission" style="display:none">
  <div class="lbl" style="margin-bottom:8px;color:#B30000">å¸æ©Ÿæ¬Šé™æœªé–‹å•Ÿ</div>
  <div style="color:#B30000;font-weight:800;font-size:15px;text-align:center;">
    å¯©æ ¸æœªé€šéï¼Œé‚„æœªé–‹å•Ÿå¸æ©Ÿæ¬Šé™
  </div>
</div>
<!-- ğŸ”´ å¯©æ ¸ä¸­æç¤ºæ¡† -->
<div class="card alert-card" id="alertPending" style="display:none">
  <div class="lbl" style="margin-bottom:8px;color:#B30000">å¯©æ ¸ä¸­</div>
  <div style="color:#B30000;font-weight:800;font-size:15px;text-align:center;">
    å¯©æ ¸ä¸­ï¼Œç„¡æ³•ä½¿ç”¨å¸æ©Ÿæ¬Šé™
  </div>
</div>
  <!-- ğŸš« ç„¡æ³•ä½¿ç”¨å¸æ©Ÿæ¬Šé™æç¤ºï¼ˆèˆ‡æ­£å¸¸è¨‚å–®å€å¡ŠåŒæ™‚é¡¯ç¤ºï¼‰ -->
  <div class="card alert-card" id="alertDisabled" style="margin-bottom:16px;">
    <div class="lbl" style="margin-bottom:8px;color:#B30000">å¸æ©Ÿæ¬Šé™</div>
    <div style="color:#B30000;font-weight:800;font-size:15px;text-align:center;">
      å¯©æŸ¥ä¸­ï¼Œç„¡æ³•ä½¿ç”¨è©²æ¬Šé™ã€‚
    </div>
  </div>
  <!-- é€²è¡Œä¸­è¨‚å–® -->
  <div class="card">
    <div class="lbl" style="margin-bottom:8px">é€²è¡Œä¸­çš„è¨‚å–®</div>
    <table class="tbl responsive" id="tblOngoing">
      <thead><tr><th>è¨‚å–®ç·¨è™Ÿ</th><th>é¡å‹</th><th>æ—¥æœŸ/æ™‚é–“</th><th>ç‹€æ…‹</th><th>é‡‘é¡</th></tr></thead>
      <tbody></tbody>
    </table>
    <div class="muted">é»æ“Šåˆ—æœƒå‰å¾€è¨‚å–®è©³æƒ…é ä¸¦æ“ä½œè¡Œç¨‹ã€‚</div>
  </div>

  <!-- åŠŸèƒ½ -->
  <div class="card" style="text-align:center">
    <div class="actions vertical" style="justify-content:center">
      <a class="btn w100" href="https://chihang-go.com/driver_past_transactions/">æ­·å²å¸³å–®</a>
    </div>
    <div class="logout-link" id="btnLogout">å¸æ©Ÿç™»å‡º</div>
  </div>
</div>

<!-- ç·¨è¼¯ Modalï¼ˆèˆ‡è¨»å†Šé ä¸€è‡´ï¼›ç„¡è¡Œç…§/è‰¯æ°‘/å€‹äººç…§ï¼›æ¨™é¡Œä¸é¡¯ç¤ºã€Œä¿®æ”¹å¯†ç¢¼ã€å››å­—ï¼‰ -->
<div class="modal" id="modalEdit" aria-hidden="true">
  <div class="modal-box" role="dialog" aria-modal="true" aria-labelledby="meTitle">
    <div class="modal-head">
      <h2 id="meTitle" class="modal-title">ç·¨è¼¯å¸æ©Ÿè³‡æ–™</h2>
      <button class="modal-close" id="editClose" type="button" aria-label="é—œé–‰">Ã—</button>
    </div>

    <!-- åŸºæœ¬è³‡æ–™ -->
    <div class="grid">
      <div class="grid"><span class="lbl">å¸³æˆ¶ï¼ˆèº«åˆ†è­‰ï¼Œä¸å¯æ›´æ”¹ï¼‰</span><input id="e_acc" class="ipt" disabled></div>
      <div class="grid"><span class="lbl">å§“å</span><input id="e_name" class="ipt" placeholder="æ‚¨çš„å§“å"></div>
      <div class="grid"><span class="lbl">ç”Ÿæ—¥</span><input id="e_birth" class="ipt" type="date"></div>
      <div class="grid"><span class="lbl">é›»è©±</span><input id="e_phone" class="ipt" type="tel" inputmode="numeric" placeholder="09xxxxxxxx" maxlength="10"></div>
      <div class="grid"><span class="lbl">Email</span><input id="e_mail" class="ipt" type="email" placeholder="example@mail.com"></div>
      <div class="grid"><span class="lbl">Line IDï¼ˆé¸å¡«ï¼‰</span><input id="e_line" class="ipt" placeholder="@ æˆ– ID"></div>
      <div class="grid"><span class="lbl">åœ°å€</span><input id="e_addr" class="ipt" placeholder="å¸‚ / å€ / è·¯ / è™Ÿâ€¦"></div>
    </div>

    <div class="sep"></div>

    <!-- é§•ç…§ -->
    <div class="grid">
      <span class="lbl">é§•ç…§ï¼ˆæ­£é¢ï¼åé¢ï¼‰</span>
      <div class="upload-col">
        <div class="file"><div class="fake">ä¸Šå‚³ é§•ç…§æ­£é¢</div><input id="e_licenseFront" type="file" accept="image/*,application/pdf"></div>
        <div class="file-name" id="n_licenseFront"></div>
        <div class="file"><div class="fake">ä¸Šå‚³ é§•ç…§åé¢</div><input id="e_licenseBack" type="file" accept="image/*,application/pdf"></div>
        <div class="file-name" id="n_licenseBack"></div>
      </div>
      <input id="e_license" class="ipt" type="date" placeholder="åˆ°æœŸæ—¥">
    </div>

    <div class="sep"></div>

    <!-- ä¿éšª -->
    <div class="grid">
      <span class="lbl">ä¿éšªï¼ˆæ­£é¢ï¼åé¢ï¼‰</span>
      <div class="upload-col">
        <div class="file"><div class="fake">ä¸Šå‚³ ä¿éšªæ­£é¢</div><input id="e_insFront" type="file" accept="image/*,application/pdf"></div>
        <div class="file-name" id="n_insFront"></div>
        <div class="file"><div class="fake">ä¸Šå‚³ ä¿éšªåé¢</div><input id="e_insBack" type="file" accept="image/*,application/pdf"></div>
        <div class="file-name" id="n_insBack"></div>
      </div>
      <input id="e_ins" class="ipt" type="date" placeholder="åˆ°æœŸæ—¥">
    </div>

    <div class="sep"></div>

    <!-- å¯†ç¢¼ï¼ˆç„¡æ¨™é¡Œæ–‡å­—ï¼‰ -->
    <div class="grid">
      <div class="grid"><span class="lbl">ç›®å‰å¯†ç¢¼</span><input id="pwd_cur" class="ipt" type="password" placeholder="è«‹è¼¸å…¥ç›®å‰å¯†ç¢¼"></div>
      <div class="muted">è‹¥æ›¾æœªæ”¹éï¼Œé è¨­ç‚ºæ‚¨çš„æ‰‹æ©Ÿè™Ÿã€‚</div>
      <div class="grid"><span class="lbl">æ–°å¯†ç¢¼</span><input id="pwd_new" class="ipt" type="password" placeholder="è‡³å°‘ 6 ç¢¼"></div>
      <div class="grid"><span class="lbl">ç¢ºèªæ–°å¯†ç¢¼</span><input id="pwd_new2" class="ipt" type="password" placeholder="å†æ¬¡è¼¸å…¥æ–°å¯†ç¢¼"></div>
      <div class="actions" style="justify-content:flex-end">
        <button id="btnChangePwd" class="btn" type="button">ä¿®æ”¹å¯†ç¢¼</button>
      </div>
    </div>

    <div class="sep"></div>

    <div class="actions" style="margin-top:6px;justify-content:flex-end">
      <button id="btnSaveEdit" class="btn" type="button">å„²å­˜è³‡æ–™</button>
    </div>
    <div class="muted" style="text-align:right;margin-top:6px;">æª”æ¡ˆæ›´æ–°å°‡é€å¯©ï¼ˆç´„ 1â€“2 å¤©ï¼‰ã€‚</div>
  </div>
</div>

<!-- è£œäº¤æ–‡ä»¶ Modalï¼ˆæ–°åŠ å…¥ï¼‰ -->
<div class="modal" id="modalDocs" aria-hidden="true">
  <div class="modal-box" role="dialog" aria-modal="true" aria-labelledby="docsTitle">
    <div class="modal-head">
      <h2 id="docsTitle" class="modal-title">è£œäº¤æ–‡ä»¶</h2>
      <button class="modal-close" id="docsClose" type="button" aria-label="é—œé–‰">Ã—</button>
    </div>

    <!-- é§•ç…§ -->
    <div class="grid">
      <span class="lbl">é§•ç…§ä¸Šå‚³ï¼ˆæ­£é¢ï¼åé¢ï¼‰</span>
      <div class="upload-col">
        <div class="file">
          <div class="fake">ä¸Šå‚³ é§•ç…§æ­£é¢</div>
          <input id="d_licenseFront" type="file" accept="image/*,application/pdf">
        </div>
        <div class="file-name" id="n_d_licenseFront"></div>

        <div class="file">
          <div class="fake">ä¸Šå‚³ é§•ç…§åé¢</div>
          <input id="d_licenseBack" type="file" accept="image/*,application/pdf">
        </div>
        <div class="file-name" id="n_d_licenseBack"></div>
      </div>
      <input id="d_license" class="ipt" type="date" placeholder="åˆ°æœŸæ—¥">
      <div class="muted">è«‹è¼¸å…¥é§•ç…§åˆ°æœŸæ—¥ã€‚</div>
    </div>

    <div class="sep"></div>

    <!-- è¡Œç…§ -->
    <div class="grid">
      <span class="lbl">è¡Œç…§ä¸Šå‚³</span>
      <div class="upload-col">
        <div class="file">
          <div class="fake">ä¸Šå‚³ è¡Œç…§</div>
          <input id="d_vehicle" type="file" accept="image/*,application/pdf">
        </div>
        <div class="file-name" id="n_d_vehicle"></div>
      </div>
    </div>

    <div class="sep"></div>

    <!-- ä¿éšª -->
    <div class="grid">
      <span class="lbl">ä¿éšªä¸Šå‚³ï¼ˆæ­£é¢ï¼åé¢ï¼‰</span>
      <div class="upload-col">
        <div class="file">
          <div class="fake">ä¸Šå‚³ ä¿éšªæ­£é¢</div>
          <input id="d_insFront" type="file" accept="image/*,application/pdf">
        </div>
        <div class="file-name" id="n_d_insFront"></div>

        <div class="file">
          <div class="fake">ä¸Šå‚³ ä¿éšªåé¢</div>
          <input id="d_insBack" type="file" accept="image/*,application/pdf">
        </div>
        <div class="file-name" id="n_d_insBack"></div>
      </div>
      <input id="d_ins" class="ipt" type="date" placeholder="åˆ°æœŸæ—¥">
      <div class="muted">è«‹è¼¸å…¥ä¿éšªåˆ°æœŸæ—¥ã€‚</div>
    </div>

    <div class="sep"></div>

    <!-- è‰¯æ°‘è­‰ -->
    <div class="grid">
      <span class="lbl">è‰¯æ°‘è­‰ä¸Šå‚³</span>
      <div class="upload-col">
        <div class="file">
          <div class="fake">ä¸Šå‚³ è‰¯æ°‘è­‰</div>
          <input id="d_police" type="file" accept="image/*,application/pdf">
        </div>
        <div class="file-name" id="n_d_police"></div>
      </div>
    </div>

    <div class="sep"></div>

    <!-- å€‹äººç…§ -->
    <div class="grid">
      <span class="lbl">å€‹äººç…§ï¼ˆè‡ªæ‹ï¼‰ä¸Šå‚³</span>
      <div class="upload-col">
        <div class="file">
          <div class="fake">ä¸Šå‚³ å€‹äººç…§ï¼ˆè‡ªæ‹ï¼‰</div>
          <input id="d_idPhoto" type="file" accept="image/*">
        </div>
        <div class="file-name" id="n_d_idPhoto"></div>
      </div>
      <div class="muted">è«‹ä¸Šå‚³æ¸…æ™°ã€æ­£é¢ã€ç„¡å¢¨é¡æˆ–å¸½å­çš„è‡ªæ‹ç…§ï¼ˆä½œç‚ºå¸æ©Ÿå€‹äººå½¢è±¡ä½¿ç”¨ï¼‰ã€‚</div>
    </div>

    <div class="sep"></div>

    <div class="actions" style="margin-top:6px;justify-content:flex-end">
      <button id="btnSubmitDocs" class="btn" type="button">é€å‡ºæ–‡ä»¶</button>
    </div>
    <div class="muted" style="text-align:right;margin-top:6px;">æ–‡ä»¶æ›´æ–°å°‡é€å¯©ï¼ˆç´„ 1â€“2 å¤©ï¼‰ã€‚</div>
  </div>
</div>

<script>
(()=>{
  const $ = s => document.querySelector(s);
  const S = sessionStorage, L = localStorage;

  const ROUTE_HOME='https://chihang-go.com/';
  const ORDER_DETAIL_URL='https://chihang-go.com/driver_order_details/';

  $('#btnBack').addEventListener('click',()=>{ if(document.referrer) history.back(); else location.href=ROUTE_HOME; });

  const safeParse = s => { try{ return JSON.parse(s||'{}') }catch{ return {} } };
  const readDriver = acc => safeParse(L.getItem(`driver_${acc}`));
  const writeDriver = (acc, obj) => L.setItem(`driver_${acc}`, JSON.stringify(obj||{}));
  const readOrders = acc => JSON.parse(L.getItem(`driver_orders_${acc}`)||'[]');
  const writeOrders = (acc, list) => L.setItem(`driver_orders_${acc}`, JSON.stringify(list||[]));

  // ===== Demo Seed =====
  (function seedAccount(){
    if(!S.getItem('driverAccount')) S.setItem('driverAccount','driverdemo');
    if(!L.getItem('driver_driverdemo')){
      writeDriver('driverdemo',{
        account:'driverdemo', password:'0912345678', name:'ç¤ºç¯„å¸æ©Ÿ',
        phone:'0912345678', email:'driver@example.com', addr:'å°åŒ—å¸‚ä¸­å±±å€',
        birth:'1990-01-01', line:'@driver',
        docs:{ license:{expire:'2026-03-01'}, insurance:{expire:'2026-06-30'} },
        status:'approved'
      });
    }
  })();
  const getAcc = () => S.getItem('driverAccount') || 'driverdemo';

  // ===== Demo è¨‚å–® =====
  function addDemoOrderEachLoad(){
    const acc = getAcc();
    const list = readOrders(acc);
    const now = new Date();
    const pad = n => String(n).padStart(2,'0');
    const stamp = `${now.getFullYear()}${pad(now.getMonth()+1)}${pad(now.getDate())}${pad(now.getHours())}${pad(now.getMinutes())}`;
    const orderId = `CH202511010002`;
    const dateStr = `${now.getFullYear()}-${pad(now.getMonth()+1)}-${pad(now.getDate())} ${pad(now.getHours())}:${pad(now.getMinutes())}`;
    const demo = {
      orderId, status:'ing', type:'æ¥æ©Ÿ', date:dateStr, total:2200,
      detail:{pickup:'æ¡ƒåœ’æ©Ÿå ´ T2 åˆ°é” 22:30', dropoff:'å°ä¸­å¸‚å—å±¯å€å…¬ç›Šè·¯ xxx è™Ÿ', flight:'BR186'}
    };
    list.unshift(demo);
    if(list.length>1) list.length = 1;
    writeOrders(acc, list);
  }

  // ===== Profile =====
  function renderProfile(){
    const d=readDriver(getAcc())||{};
    $('#welcome').textContent='æ­¡è¿å›ä¾† ' + (d.name||'');
    $('#v_acc').textContent=d.account||'â€”';
    $('#v_name').textContent=d.name||'â€”';
    $('#v_phone').textContent=d.phone||'â€”';
    $('#v_mail').textContent=d.email||'â€”';
    $('#v_addr').textContent=d.addr||'â€”';
    $('#v_licenseDue').textContent=d?.docs?.license?.expire || 'â€”';
    $('#v_insDue').textContent=d?.docs?.insurance?.expire || 'â€”';
  }

  // ===== Orders =====
  function renderOrders(){
    const list=readOrders(getAcc())||[];
    const ongoing=list.filter(o=>o.status==='ing');
    const tbody=$('#tblOngoing tbody');
    tbody.innerHTML = ongoing.length ? ongoing.map(o=>`
      <tr class="order-row" data-id="${o.orderId}">
        <td data-col="id">${o.orderId}</td>
        <td data-col="type">${o.type}</td>
        <td data-col="date">${o.date}</td>
        <td data-col="status"><span class="badge ing">é€²è¡Œä¸­</span></td>
        <td data-col="amount" style="text-align:right">${Number(o.total||0).toLocaleString()} å…ƒ</td>
      </tr>`).join('')
      : `<tr class="order-row"><td data-col="id">ç›®å‰æ²’æœ‰é€²è¡Œä¸­çš„è¨‚å–®</td></tr>`;
  }

  // é»åˆ— â†’ è©³æƒ…
  document.addEventListener('click',e=>{
    const row=e.target.closest?.('.order-row'); 
    if(!row) return;
    const id=row.dataset.id; 
    if(id) location.href = `${ORDER_DETAIL_URL}?id=${encodeURIComponent(id)}`;
  });

  // ===== Modal æ§åˆ¶ =====
  const modalEdit=$('#modalEdit');
  const modalDocs=$('#modalDocs');
  function openModal(m){ m.classList.add('active'); m.setAttribute('aria-hidden','false'); }
  function closeModal(m){ m.classList.remove('active'); m.setAttribute('aria-hidden','true'); }

  // ç·¨è¼¯è³‡æ–™
  $('#btnEdit').addEventListener('click',()=>{
    const d=readDriver(getAcc())||{};
    $('#e_acc').value=d.account||''; 
    $('#e_name').value=d.name||''; 
    $('#e_birth').value=d.birth||'';
    $('#e_phone').value=d.phone||'';
    $('#e_mail').value=d.email||'';
    $('#e_line').value=d.line||'';
    $('#e_addr').value=d.addr||'';
    $('#e_license').value=d?.docs?.license?.expire||'';
    $('#e_ins').value=d?.docs?.insurance?.expire||'';
    openModal(modalEdit);
  });
  $('#editClose').addEventListener('click',()=>closeModal(modalEdit));
  document.addEventListener('click',e=>{ if(e.target===modalEdit) closeModal(modalEdit); });

  // å„²å­˜è³‡æ–™
  $('#btnSaveEdit').addEventListener('click',()=>{
    const acc=getAcc(), d=readDriver(acc)||{};
    d.name=$('#e_name').value.trim();
    d.phone=$('#e_phone').value.trim();
    d.email=$('#e_mail').value.trim();
    d.addr=$('#e_addr').value.trim();
    d.docs.license.expire=$('#e_license').value.trim();
    d.docs.insurance.expire=$('#e_ins').value.trim();
    writeDriver(acc,d);
    closeModal(modalEdit);
    renderProfile();
    alert('å·²å„²å­˜è³‡æ–™ï¼ˆæª”æ¡ˆå°‡é€å¯©ï¼‰ã€‚');
  });

  // ===== è£œäº¤æ–‡ä»¶ Modal =====
  const btnReupload=$('#btnReupload');
  const docsClose=$('#docsClose');

  function openDocs(){
    if(!modalDocs) return;
    modalDocs.querySelectorAll('.file-name').forEach(el=>el.textContent='');
    openModal(modalDocs);
  }
  function closeDocs(){ closeModal(modalDocs); }

  btnReupload?.addEventListener('click',openDocs);
  docsClose?.addEventListener('click',closeDocs);
  document.addEventListener('click',e=>{ if(e.target===modalDocs) closeDocs(); });

  // é€å‡ºè£œäº¤æ–‡ä»¶
  $('#btnSubmitDocs').addEventListener('click',()=>{
    closeDocs();
    const toast=document.createElement('div');
    toast.textContent='æ–‡ä»¶å·²é€å‡ºï¼Œå¾…å¯©ä¸­';
    Object.assign(toast.style,{
      position:'fixed',bottom:'20px',left:'50%',transform:'translateX(-50%)',
      background:'#00B881',color:'#fff',padding:'12px 20px',
      borderRadius:'50px',fontWeight:'900',fontSize:'15px',
      zIndex:'9999',opacity:'0',transition:'opacity .3s'
    });
    document.body.appendChild(toast);
    setTimeout(()=>toast.style.opacity='1',50);
    setTimeout(()=>{toast.style.opacity='0';setTimeout(()=>toast.remove(),400)},2000);
  });

  // ç™»å‡º
  $('#btnLogout').addEventListener('click',()=>{
    S.removeItem('driverAccount');
    location.href='https://chihang-go.com/driver_login/';
  });

  // ===== åˆå§‹åŒ– =====
  addDemoOrderEachLoad();
  renderProfile();
  const driver = readDriver(getAcc()) || {};
  if(driver.status === 'pending'){
    document.querySelector('#alertPending').style.display='block';
    document.querySelector('#alertPermission').style.display='none';
    document.querySelector('#tblOngoing').style.pointerEvents='none';
    document.querySelector('#tblOngoing').style.opacity='.5';
  }else if(driver.status !== 'approved'){
    document.querySelector('#alertPermission').style.display='block';
    document.querySelector('#alertPending').style.display='none';
    document.querySelector('#tblOngoing').style.pointerEvents='none';
    document.querySelector('#tblOngoing').style.opacity='.5';
  }else{
    document.querySelector('#alertPermission').style.display='none';
    document.querySelector('#alertPending').style.display='none';
    document.querySelector('#tblOngoing').style.pointerEvents='auto';
    document.querySelector('#tblOngoing').style.opacity='1';
  }
  renderOrders();
})();
</script>
</body>
</html>